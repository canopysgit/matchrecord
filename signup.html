<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>周报名 - 足球队报名与数据统计系统</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 顶部导航栏 -->
    <nav class="navbar">
        <div class="nav-brand">⚽ 足球队管理系统</div>
        <ul class="nav-menu">
            <li><a href="index.html">首页</a></li>
            <li><a href="signup.html" class="active">比赛报名</a></li>
            <li><a href="record.html">记录数据</a></li>
            <li><a href="results.html">比赛结果</a></li>
            <li><a href="stats.html">球员统计</a></li>
        </ul>
    </nav>

    <!-- 主要内容区 -->
    <main class="container">
        <!-- 比赛信息 -->
        <section class="match-info-section">
            <div class="match-info-card">
                <div class="form-group">
                    <label for="matchDate">比赛日期</label>
                    <input type="date" id="matchDate" name="matchDate" required>
                </div>
                <div class="form-group">
                    <label for="matchTimeSlot">比赛时间</label>
                    <select id="matchTimeSlot" name="matchTimeSlot" required>
                        <option value="" disabled>请选择时间段</option>
                        <option value="14:00-16:00">14:00-16:00</option>
                        <option value="16:00-18:00" selected>16:00-18:00</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="matchType">比赛性质</label>
                    <select id="matchType" name="matchType">
                        <option value="内战">内战</option>
                        <option value="外战">外战</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="matchVenue">比赛场地</label>
                    <input type="text" id="matchVenue" name="matchVenue" value="机场">
                </div>
            </div>
        </section>

        <!-- 球员选择 -->
        <section class="player-selection-section">
            <!-- 分队结果 -->
            <div class="teams-container">
                <div class="team white-team">
                    <h3>白队</h3>
                    <ul id="whiteTeam"></ul>
                </div>
                <div class="team blue-team">
                    <h3>蓝队</h3>
                    <ul id="blueTeam"></ul>
                </div>
            </div>

            <!-- 队长选择区域 -->
            <div class="captain-selection">
                <h3>选择队长</h3>
                <div class="captain-buttons">
                    <div class="team-captain">
                        <h4>白队队长</h4>
                        <select id="whiteCaptain" class="captain-select">
                            <option value="">请选择队长</option>
                        </select>
                    </div>
                    <div class="team-captain">
                        <h4>蓝队队长</h4>
                        <select id="blueCaptain" class="captain-select">
                            <option value="">请选择队长</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 球员列表 -->
            <div class="player-lists">
                <!-- 主力球员名单 -->
                <div class="player-list">
                    <h3 class="section-title">主力球员</h3>
                    <ul id="mainPlayerList" class="player-grid">
                        <!-- 主力球员列表将通过JavaScript动态生成 -->
                    </ul>
                </div>

                <!-- 外援球员区域 -->
                <div class="guest-section">
                    <h3 class="section-title">外援球员</h3>
                    <ul id="guestPlayerList" class="player-grid">
                        <!-- 外援球员列表将通过JavaScript动态生成 -->
                    </ul>
                </div>
            </div>
        </section>

        <!-- 提交按钮 -->
        <div class="submit-section">
            <button type="button" class="btn-primary" id="submitTeams">保存分队</button>
        </div>

        <!-- 添加确认弹窗 -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>确认分队结果</h3>
                </div>
                <div class="modal-body">
                    <div class="team-preview">
                        <div class="team-column">
                            <h4>白队</h4>
                            <ul id="whiteTeamPreview" class="team-preview-list"></ul>
                        </div>
                        <div class="team-column">
                            <h4>蓝队</h4>
                            <ul id="blueTeamPreview" class="team-preview-list"></ul>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeConfirmModal()">返回修改</button>
                    <button class="btn-primary" onclick="confirmTeams()">确认</button>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <p>© 2024 足球队报名与数据统计系统</p>
    </footer>

    <!-- 添加样式 -->
    <style>
    .captain-selection {
        margin: 2rem 0;
        padding: 1rem;
        background-color: #f8f9fa;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .captain-buttons {
        display: flex;
        justify-content: space-around;
        gap: 2rem;
        margin-top: 1rem;
    }

    .team-captain {
        flex: 1;
        text-align: center;
    }

    .captain-select {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-top: 0.5rem;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 1000;
    }

    .modal-content {
        background-color: white;
        margin: 10% auto;
        padding: 2rem;
        width: 90%;
        max-width: 800px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .team-preview {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin: 1rem 0;
    }

    .team-preview-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .team-preview-list li {
        padding: 0.5rem;
        border-bottom: 1px solid #eee;
    }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 2rem;
    }

    .btn-secondary {
        padding: 0.5rem 1rem;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-secondary:hover {
        background-color: #5a6268;
    }

    .team-header {
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #1E88E5;
    }

    .captain-info {
        color: #1E88E5;
        font-weight: bold;
        font-size: 1.1rem;
    }

    .captain-selection {
        background-color: #e3f2fd;  /* 更亮的蓝色背景 */
        border: 2px solid #1E88E5;  /* 添加边框 */
    }

    .captain-selection h3 {
        color: #1E88E5;
        text-align: center;
        margin-bottom: 1rem;
    }

    .team-captain h4 {
        color: #1E88E5;
    }

    .captain-select {
        border: 2px solid #1E88E5;
        font-size: 1rem;
        color: #1E88E5;
    }

    .captain-select option {
        padding: 0.5rem;
    }
    </style>

    <script>
        // 主力球员数据
        const mainPlayers = [
            "霏赫", "阿曼", "嘉磊", "赵哥", "赵祺", "罗霄", "广文", "黄鹏", 
            "马指", "邵林", "一陶", "尚枫", "朱门", "小鹤", "陈光", "井", 
            "杨超", "金昊", "张健", "小常", "赵军", "扇子", "毛毛", "威威", 
            "蔡湑", "袁祎", "李蒙", "宣宇", "康进", "旭东", "田爽", "贾楠", 
            "麦克", "勋哥", "小杰", "马蒂", "肖凯", "文征"
        ];

        // 外援球员数据
        const guestPlayers = ["大雄", "贺楠", "小段", "青格勒"];

        // 初始化球员列表
        function initializePlayers() {
            const mainPlayerList = document.getElementById('mainPlayerList');
            const guestPlayerList = document.getElementById('guestPlayerList');

            // 清空现有内容
            mainPlayerList.innerHTML = '';
            guestPlayerList.innerHTML = '';

            // 添加主力球员
            mainPlayers.forEach(playerName => {
                const li = createPlayerListItem(playerName);
                mainPlayerList.appendChild(li);
            });

            // 添加外援球员
            guestPlayers.forEach(playerName => {
                const li = createPlayerListItem(playerName);
                guestPlayerList.appendChild(li);
            });

            // 绑定保存按钮事件
            document.getElementById('submitTeams').addEventListener('click', saveTeams);
            
            // 初始化队长选择
            initializeCaptainSelects();
        }

        // 创建球员列表项
        function createPlayerListItem(playerName) {
            const li = document.createElement('li');
            li.innerHTML = `
                <span class="player-name">${playerName}</span>
                <div class="button-group">
                    <button class="team-btn white" data-team="whiteTeam">白</button>
                    <button class="team-btn blue" data-team="blueTeam">蓝</button>
                </div>
            `;
            
            // 绑定按钮事件
            const buttons = li.querySelectorAll('.team-btn');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    handleTeamButtonClick(this, playerName);
                });
            });
            
            return li;
        }

        // 处理队伍按钮点击
        function handleTeamButtonClick(button, playerName) {
            const playerLi = button.closest('li');
            const team = button.getAttribute('data-team');
            const otherTeam = team === 'whiteTeam' ? 'blueTeam' : 'whiteTeam';
            
            // 更新按钮状态
            const whiteBtn = playerLi.querySelector('.team-btn.white');
            const blueBtn = playerLi.querySelector('.team-btn.blue');
            
            // 如果是已选中的按钮，则取消选择
            if (button.classList.contains('selected')) {
                button.classList.remove('selected');
                removePlayerFromTeam(playerName, team);
                return;
            }
            
            // 移除之前的选中状态
            whiteBtn.classList.remove('selected');
            blueBtn.classList.remove('selected');
            button.classList.add('selected');
            
            // 从另一个队伍中移除
            removePlayerFromTeam(playerName, otherTeam);

            // 添加到选中的队伍
            addPlayerToTeam(playerName, team, playerLi);
        }

        // 从队伍中移除球员
        function removePlayerFromTeam(playerName, teamId) {
            const teamList = document.getElementById(teamId);
            if (!teamList) return;
            
            const playerToRemove = Array.from(teamList.children).find(li => 
                li.textContent.trim().startsWith(playerName)
            );
            
            if (playerToRemove) {
                playerToRemove.remove();
                // 更新队长选择下拉框
                updateCaptainSelects();
            }
        }

        // 添加球员到队伍
        function addPlayerToTeam(playerName, teamId, originalLi) {
            const teamList = document.getElementById(teamId);
            if (!teamList) return;
            
            // 检查是否已经在队伍中
            const existingPlayer = Array.from(teamList.children).find(li => 
                li.textContent.trim().replace('(C)', '').replace('×', '').trim() === playerName
            );
            
            if (!existingPlayer) {
                const teamLi = document.createElement('li');
                teamLi.innerHTML = `
                    <span class="player-name">${playerName}</span>
                    <button class="delete-btn" title="移除">×</button>
                `;
                teamList.appendChild(teamLi);
                
                // 绑定删除按钮事件
                const deleteBtn = teamLi.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    // 如果是队长，清除队长选择
                    const captainSelect = teamId === 'whiteTeam' ? 'whiteCaptain' : 'blueCaptain';
                    if (document.getElementById(captainSelect).value === playerName) {
                        document.getElementById(captainSelect).value = '';
                    }
                    
                    // 找到原始球员列表中的对应球员
                    const playerLists = document.querySelectorAll('.player-grid');
                    playerLists.forEach(list => {
                        const originalPlayerLi = Array.from(list.children).find(li => 
                            li.querySelector('.player-name').textContent === playerName
                        );
                        if (originalPlayerLi) {
                            originalPlayerLi.querySelectorAll('.team-btn').forEach(btn => {
                                btn.classList.remove('selected');
                            });
                        }
                    });
                    
                    // 移除队伍中的球员
                    teamLi.remove();
                    // 更新队长选择下拉框
                    updateCaptainSelects();
                });

                // 更新队长选择下拉框
                updateCaptainSelects();
            }
        }

        // 更新队长选择下拉框
        function updateCaptainSelects() {
            const whiteCaptainSelect = document.getElementById('whiteCaptain');
            const blueCaptainSelect = document.getElementById('blueCaptain');
            
            // 保存当前选中的队长
            const currentWhiteCaptain = whiteCaptainSelect.value;
            const currentBlueCaptain = blueCaptainSelect.value;
            
            // 获取当前队伍成员
            const whiteTeamMembers = Array.from(document.getElementById('whiteTeam').children)
                .map(li => li.querySelector('.player-name').textContent.replace('(C)', '').trim());
            const blueTeamMembers = Array.from(document.getElementById('blueTeam').children)
                .map(li => li.querySelector('.player-name').textContent.replace('(C)', '').trim());
            
            // 更新白队队长选项
            whiteCaptainSelect.innerHTML = '<option value="">请选择队长</option>' +
                whiteTeamMembers.map(player => `<option value="${player}">${player}</option>`).join('');
            
            // 更新蓝队队长选项
            blueCaptainSelect.innerHTML = '<option value="">请选择队长</option>' +
                blueTeamMembers.map(player => `<option value="${player}">${player}</option>`).join('');
            
            // 复之前选中的队长
            if (currentWhiteCaptain && whiteTeamMembers.includes(currentWhiteCaptain)) {
                whiteCaptainSelect.value = currentWhiteCaptain;
            }
            if (currentBlueCaptain && blueTeamMembers.includes(currentBlueCaptain)) {
                blueCaptainSelect.value = currentBlueCaptain;
            }
        }

        // 添加队长选择事件处理
        function initializeCaptainSelects() {
            const whiteCaptainSelect = document.getElementById('whiteCaptain');
            const blueCaptainSelect = document.getElementById('blueCaptain');
            
            whiteCaptainSelect.addEventListener('change', function() {
                updateCaptainDisplay('whiteTeam', this.value);
            });
            
            blueCaptainSelect.addEventListener('change', function() {
                updateCaptainDisplay('blueTeam', this.value);
            });
        }

        // 更新队长显示
        function updateCaptainDisplay(teamId, captainName) {
            const teamList = document.getElementById(teamId);
            
            // 移除所有队长标记
            teamList.querySelectorAll('.player-name').forEach(span => {
                span.textContent = span.textContent.replace('(C)', '').trim();
            });
            
            // 添加新队长标记
            if (captainName) {
                const captainLi = Array.from(teamList.children).find(li => 
                    li.querySelector('.player-name').textContent.trim() === captainName
                );
                if (captainLi) {
                    const nameSpan = captainLi.querySelector('.player-name');
                    nameSpan.textContent = `${captainName}(C)`;
                }
            }
        }

        // 保存分队结果
        function saveTeams() {
            // 检查比赛日期和时间
            const matchDate = document.getElementById('matchDate').value;
            const matchTime = document.getElementById('matchTimeSlot').value;
            
            console.log('比赛日期:', matchDate); // 调试信息
            console.log('比赛时间:', matchTime); // 调试信息
            
            if (!matchDate) {
                console.log('日期为空'); // 调试信息
                alert('请选择比赛日期！');
                document.getElementById('matchDate').focus();
                return;
            }
            
            if (!matchTime) {
                console.log('时间为空'); // 调试信息
                alert('请选择比赛时间！');
                document.getElementById('matchTimeSlot').focus();
                return;
            }

            // 检查是否有队员被选中
            const whiteTeamCount = document.getElementById('whiteTeam').children.length;
            const blueTeamCount = document.getElementById('blueTeam').children.length;
            
            console.log('白队人数:', whiteTeamCount); // 调试信息
            console.log('蓝队人数:', blueTeamCount); // 调试信息
            
            if (whiteTeamCount === 0 && blueTeamCount === 0) {
                alert('请至少选择一名队员！');
                return;
            }

            const whiteCaptain = document.getElementById('whiteCaptain').value;
            const blueCaptain = document.getElementById('blueCaptain').value;
            
            // 获取队伍成员，如果是队长则添加(C)标记
            const whiteTeam = Array.from(document.getElementById('whiteTeam').children).map(li => {
                const name = li.textContent.trim().replace('×', '').trim();
                return whiteCaptain && name === whiteCaptain ? `${name}(C)` : name;
            });
            
            const blueTeam = Array.from(document.getElementById('blueTeam').children).map(li => {
                const name = li.textContent.trim().replace('×', '').trim();
                return blueCaptain && name === blueCaptain ? `${name}(C)` : name;
            });
            
            // 显示确认弹窗
            showConfirmModal(whiteTeam, blueTeam, whiteCaptain, blueCaptain);
        }

        // 显示确认弹窗
        function showConfirmModal(whiteTeam, blueTeam, whiteCaptain, blueCaptain) {
            const modal = document.getElementById('confirmModal');
            const whitePreview = document.getElementById('whiteTeamPreview');
            const bluePreview = document.getElementById('blueTeamPreview');
            
            // 显示白队名单
            whitePreview.innerHTML = `
                <div class="team-header">
                    ${whiteCaptain ? `<div class="captain-info">队长：${whiteCaptain}</div>` : ''}
                </div>
                ${whiteTeam.map(player => `<li>${player}</li>`).join('')}
            `;
            
            // 显示蓝队名单
            bluePreview.innerHTML = `
                <div class="team-header">
                    ${blueCaptain ? `<div class="captain-info">队长：${blueCaptain}</div>` : ''}
                </div>
                ${blueTeam.map(player => `<li>${player}</li>`).join('')}
            `;
            
            modal.style.display = 'block';
        }

        // 关闭确认弹窗
        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        // 确认分队
        function confirmTeams() {
            const whiteCaptain = document.getElementById('whiteCaptain').value;
            const blueCaptain = document.getElementById('blueCaptain').value;
            
            // 获取队伍成员，如果是队长则添加(C)标记
            const whiteTeam = Array.from(document.getElementById('whiteTeam').children).map(li => {
                const name = li.textContent.trim().replace('×', '').trim();
                return whiteCaptain && name === whiteCaptain ? `${name}(C)` : name;
            });
            
            const blueTeam = Array.from(document.getElementById('blueTeam').children).map(li => {
                const name = li.textContent.trim().replace('×', '').trim();
                return blueCaptain && name === blueCaptain ? `${name}(C)` : name;
            });
            
            // 创建比赛数据结构
            const matchData = {
                id: `match_${new Date().getTime()}`,
                status: 'pending',
                basicInfo: {
                    date: document.getElementById('matchDate').value,
                    time: document.getElementById('matchTimeSlot').value,
                    type: document.getElementById('matchType').value,
                    venue: document.getElementById('matchVenue').value,
                    createdAt: new Date().toISOString()
                },
                teams: {
                    white: {
                        players: whiteTeam,
                        captain: whiteCaptain || '',
                        score: 0,
                        stats: {
                            goals: [],
                            assists: []
                        }
                    },
                    blue: {
                        players: blueTeam,
                        captain: blueCaptain || '',
                        score: 0,
                        stats: {
                            goals: [],
                            assists: []
                        }
                    }
                }
            };

            // 保存到 localStorage
            localStorage.setItem('currentMatch', JSON.stringify(matchData));

            // 关闭弹窗
            closeConfirmModal();
            
            // 跳转到记录页面
            window.location.href = 'record.html';
        }

        // 点击弹窗外部关闭
        window.onclick = function(event) {
            const modal = document.getElementById('confirmModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', initializePlayers);
    </script>
</body>
</html> 